---
layout: post
title: httpä¸Šä¼ æ–‡ä»¶
date: 2019-5-19 20:18:45 +0800
tag: httpåè®®è¯¦è§£
---

* content
{:toc}

çªç„¶å‘ç°ä¸Šä¼ æ–‡ä»¶è¿˜æ²¡æœ‰æµ‹

ä»£ç ï¼š
```pascal
{$mode objfpc}
uses zul_http;
 function display(req:http_message_C):http_message_S;
 var
  i:longint;
 begin
  writeln('Method:',req.method);
  writeln('Url:',req.url);
  writeln('Agreement:',req.agreement);
  writeln('Opt:');
  for i:=0 to length(req.opt)-1 do
   begin
    writeln(' key=',req.opt[i].key);
    writeln('value=',req.opt[i].value);
   end;
  writeln('data=',req.data);
  writeln('ok');
  display.agreement:='HTTP/1.1';
  display.status_number:=200;
  display.status:='OK';
  setlength(display.opt,1);
  display.opt[0].key:='Content-Type';
  display.opt[0].value:='text/html';
  display.data:=
  '<html>'+#13#10+
      '<head>'+#13#10+
          '<meta charset="utf-8">'+#13#10+
      '</head>'+#13#10+
      '<body>'+#13#10+
          '<form method="post" action="1.html" enctype="multipart/form-data">'+#13#10+
              '<input type="file" name="wtf" multiple="multiple">'+#13#10+
              '<input type="submit">'+#13#10+
          '</form>'+#13#10+
      '</body>'+#13#10+
  '</html>';
 end;
begin
 resp:=@display;
 port:=8000;
 readln;
 start;
end.
```

ç„¶åä¸Šä¼ æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š

```
fsdgfsdhcjbfhewrjefsd
fsdfdsgfdsjfjrehfdhgdfjfsd
fsd'
fdsgsdjksahjfsdhfsx
fd'hd
fd
h
fg
ds
gf
hre'
tre['yp657kl4ol;597
re
veo6ppc;x ,iopot -0o23p4o231';wo21p[54
```

ç„¶åä¸Šä¼ ï¼Œæ˜¾ç¤ºå‡ºäº†è¿™äº›ä¸œè¥¿ï¼š

```
Method:GET
Url:/
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Purpose: prefetch
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
data=
ok
Method:GET
Url:/favicon.ico
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://localhost:8000/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
data=
ok
Method:POST
Url:/1.html
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Content-Length: 369
Cache-Control: max-age=0
Origin: http://localhost:8000
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryRTI5ytD7yUJveBKY
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://localhost:8000/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
data=
ok
Method:POST
Url:/1.html
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Content-Length: 369
Cache-Control: max-age=0
Origin: http://localhost:8000
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryRTI5ytD7yUJveBKY
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://localhost:8000/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
 key=
value=
------WebKitFormBoundaryRTI5ytD7yUJveBKY
 key=Content-Disposition
value= form-data; name="wtf"; filename="test.test"
 key=Content-Type
value= application/octet-stream
data=fsdgfsdhcjbfhewrjefsd
fsdfdsgfdsjfjrehfdhgdfjfsd
fsd'
fdsgsdjksahjfsdhfsx
fd'hd
fd
h
fg
ds
gf
hre'
tre['yp657kl4ol;597
re
veo6ppc;x ,iopot -0o23p4o231';wo21p[54
------WebKitFormBoundaryRTI5ytD7yUJveBKY--

ok
Method:GET
Url:/favicon.ico
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://localhost:8000/1.html
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
data=
ok
```

æ–‡ä»¶æ•°æ®æˆªå–æœ‰ç‚¹æ¯’ç˜¤

P.S. å¦‚æœä¸åŠ `enctype`å’Œ`multiple`å°±åªä¼šæŠŠæ–‡ä»¶åä¼ è¿‡å»â€¦â€¦â€¦â€¦

å¦‚æœä¸é€‰æ‹©æ–‡ä»¶ï¼š

```
Method:POST
Url:/1.html
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Content-Length: 187
Cache-Control: max-age=0
Origin: http://localhost:8000
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx1UWFWPaTcCgBPnV
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://localhost:8000/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
 key=
value=
------WebKitFormBoundaryx1UWFWPaTcCgBPnV
 key=Content-Disposition
value= form-data; name="wtf"; filename=""
 key=Content-Type
value= application/octet-stream
data=
------WebKitFormBoundaryx1UWFWPaTcCgBPnV--
```

ç„¶åæˆ‘ä»¬å†è¯•è¯•ä¼ å«æœ‰ä¸å¯è§å­—ç¬¦çš„æ–‡ä»¶ï¼š

ç„¶åä½ ä¼šå‘ç°è¿™ä¸ªç¨‹åºå´©æ‰äº†â€¦â€¦â€¦â€¦

ä½†æ˜¯è¿™ä¸ªç¨‹åºåœ¨è¡Œå°†å°±æœ¨çš„æ—¶å€™è¾“å‡ºäº†è¿™ä¸ªï¼š

```
Method:POST
Url:/1.html
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Content-Length: 9253
Cache-Control: max-age=0
Origin: http://localhost:8000
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryuA47XpGJBBAjrlxj
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://localhost:8000/1.html
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
 key=
value=
------WebKitFormBoundaryuA47XpGJBBAjrlxj
 key=Content-Disposition
value= form-data; name="wtf"; filename="psb (6).webp"
 key=Content-Type
value= image/webp
 key=
value=
 key=RIFFd#  WEBPVP8 X#  p? ?*? d>Q$å»ï¼‚!å£µ?ç¼j     }éœ»ç´èƒ¨[å¿ºæ£‚é‹µéµšè’èš©å¦
??é¯»?èˆ†?é®›?y>å€î…—??ç½??é ºå¨²?åš,î‹é—¥?è”©æŒ£â‰¯?gè‘³Mè‰ªå‡¯~æ¬¨å¤»Kî¡“çš?X?éª·é€®å®Œ??è µ?Xç¡¤æŠ›îƒªaå” qå¼›+?ç˜è‘¡f`æ°Œ4ji?â‚¬Bç¨¹L??é³¬æ»ƒé³æ‡šç“R?åŸšqfæœ‚â”œéŸ¦>7? è·é½,?ã‚¢Fç ¤^#åˆ–9tXè‡ªYå’§2-?Ké¼¾çœŸ6 |çœ”2X`ä»›?nyR8î®åª†?     B?4è¡é­“æ¦Ÿ!ä¾’#é—‡é¡­?;î™¨ué»˜ï¼¥p.ré›¼^S7?CæŒ? è¾Œjî ¸ç¢±æš®dç…\ä½å²€fé¼œAæ—œ?S/éº qå³ƒåNå²ˆa|`è¤Œç¶?å£»ç¾³0éŸ’è·°åº¥h -è©‚?'xXî ??Ré¸šæ¶šé¶«?èŒ‰â‚¬Nè²°é†Ÿq?Ymï£µî‘?é¶¨é²´è”¶ï£µä½®æ“…è„€=w?è¾€ã„ˆé–”`è¢ŒJç¿¦?åƒ›såµ¿å½œî•Â·2Runtime error 101 at $0040162B
  $0040162B

4{???éµ¶é¡=d"{<dpé¨†?å½’?? 7"è¨\7å›˜?èª¥é–)ç¯‡å½‡ipt?æ‹§é‘™æ§^'çŸ¶è¹¿Iå–ƒ*æ‹åœ¾?Zé ºæ…—é·œ?kçH"XXçªŒçºä¸é£ C@î„—åš›è¥£Method:
Url:
Agreement:
Opt:
data=
ok
```

å› ä¸ºéæ³•å­—ç¬¦è¾“å‡ºè¿‡å¤šä¼šå¼•å‘ä¸€äº›ä¸å¥½çš„ç»“æœ

æ‰€ä»¥æˆ‘ä»¬æ”¹æˆè¿™æ ·ï¼š

```pascal
{$mode objfpc}
uses zul_http;
 function display(req:http_message_C):http_message_S;
 var
  i:longint;
 begin
  writeln('Method:',req.method);
  writeln('Url:',req.url);
  writeln('Agreement:',req.agreement);
  writeln('Opt:');
  for i:=0 to length(req.opt)-1 do
   begin
    writeln(' key=',length(req.opt[i].key));
    writeln('value=',length(req.opt[i].value));
   end;
  writeln('data=',length(req.data));
  writeln('ok');
  display.agreement:='HTTP/1.1';
  display.status_number:=200;
  display.status:='OK';
  setlength(display.opt,1);
  display.opt[0].key:='Content-Type';
  display.opt[0].value:='text/html';
  display.data:=
  '<html>'+#13#10+
      '<head>'+#13#10+
          '<meta charset="utf-8">'+#13#10+
      '</head>'+#13#10+
      '<body>'+#13#10+
          '<form method="post" action="1.html" enctype="multipart/form-data">'+#13#10+
              '<input type="file" name="wtf" multiple="multiple">'+#13#10+
              '<input type="submit">'+#13#10+
          '</form>'+#13#10+
      '</body>'+#13#10+
  '</html>';
 end;
begin
 resp:=@display;
 port:=8000;
 readln;
 start;
end.
```

ç„¶åè¾“å‡ºå¦‚ä¸‹ï¼š

```
Method:POST
Url:/1.html
Agreement:HTTP/1.1
Host: localhost:8000
Connection: keep-alive
Content-Length: 9253
Cache-Control: max-age=0
Origin: http://localhost:8000
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarylAJBu6AmIcJHKk99
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Referer: http://localhost:8000/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Opt:
 key=0
value=41
 key=19
value=47
 key=12
value=11
 key=0
value=0
 key=714
value=8353
data=42
ok
```

çœ‹åˆ°`8353`è¯´æ˜æˆåŠŸäº†ï¼Œè€Œä¸”ç¨‹åºä¹Ÿæ²¡æœ‰å´©æ‰